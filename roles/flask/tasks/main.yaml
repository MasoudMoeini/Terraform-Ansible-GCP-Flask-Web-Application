---
- name: Ensure pip is at the latest version
  apt:
    name: python3-pip
    state: latest
    update_cache: yes
- name: Create a destination app directory if it does not exist
  file:
    path: /home/app/templates
    state: directory
- name: Your copy task
  copy: src={{ item.src }} dest={{ item.dest }}
  with_items:
    - { src: 'files/app.py', dest: '/home/app/app.py' }
    - { src: 'files/main.py', dest: '/home/app/main.py'  }
    - { src: 'files/minst.py', dest: '/home/app/minst.py' }
    - { src: 'files/model.h5', dest: '/home/app/model.h5' }
    - { src: 'files/requirements.txt', dest: '/home/app/requirements.txt' }

#- name: install modules in a virtualenv
  #  pip: #requirements: /home/{{ ansible_ssh_user }}/{{ app_name }}/requirements.txt

- name: copy contents of templates directory
  copy:
    src: files/templates/ 
    dest: /home/app/templates/
    directory_mode:
  tags:
    - dircontent
  #installing libraries
- name: install python libraries
  pip:
    requirements: /home/app/requirements.txt
    extra_args: --no-cache-dir
#- name: execute flaskstroy application, run my script!
 #command: python3 ./home/masod_atc/main.py
- name: copy template systemd service config
  copy:
    src: .service
    dest: /etc/systemd/system/flask.service
- name: Start Systemd Flask App Service 
  systemd: name=flask state=started daemon_reload=yes 
     

